<!DOCTYPE html>
<html>
  <head>
    <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
    <script src="https://unpkg.com/aframe-environment-component@1.3.3/dist/aframe-environment-component.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/c-frame/aframe-physics-system@v4.2.2/dist/aframe-physics-system.min.js"></script>
    <script>
      AFRAME.registerComponent('game-manager', {
        init: function () {
          const startBtn = document.querySelector('#start-button');
          const menu = document.querySelector('#menu');
          const scene = this.el;

          startBtn.addEventListener('click', () => {
            menu.setAttribute('visible', 'false');
            startBtn.setAttribute('class', 'not-clickable');
            this.generateCity();
          });
        },
        generateCity: function () {
          const scene = this.el;
          for (let i = 0; i < 40; i++) {
            let box = document.createElement('a-box');
            let x = (Math.random() * 100) - 50;
            let z = (Math.random() * 100) - 50;
            let h = (Math.random() * 15) + 5;
            box.setAttribute('position', {x: x, y: h/2, z: z});
            box.setAttribute('width', 8);
            box.setAttribute('depth', 8);
            box.setAttribute('height', h);
            box.setAttribute('color', '#444');
            box.setAttribute('dynamic-body', 'mass: 100');
            scene.appendChild(box);
          }
          for (let i = 0; i < 30; i++) {
            let person = document.createElement('a-sphere');
            person.setAttribute('position', {x: (Math.random() * 40) - 20, y: 1, z: (Math.random() * 40) - 20});
            person.setAttribute('radius', '1');
            person.setAttribute('color', 'red');
            person.setAttribute('dynamic-body', 'mass: 1');
            person.setAttribute('class', 'target');
            person.addEventListener('collide', function (e) {
              if(e.detail.body.el.id === 'giant-hand') {
                this.remove();
              }
            });
            scene.appendChild(person);
          }
        }
      });
    </script>
  </head>
  <body>
    <a-scene game-manager physics="debug: false; gravity: -9.8" cursor="rayOrigin: mouse" raycaster="objects: .clickable">
      
      <a-entity environment="preset: city; dressingAmount: 0"></a-entity>

      <a-entity id="menu" position="0 45 -10">
        <a-plane color="#222" width="12" height="6" position="0 0 0"></a-plane>
        <a-text value="GIANT SIMULATOR" align="center" position="0 1.5 0.1" width="20"></a-text>
        <a-box id="start-button" class="clickable" color="#00FF00" depth="0.5" height="1.5" width="4" position="0 -1 0.1">
          <a-text value="START" align="center" position="0 0 0.3" width="10" color="black"></a-text>
        </a-box>
      </a-entity>

      <a-entity id="rig" movement-controls="fly: false; speed: 0.5" position="0 40 10">
        <a-camera>
          <a-entity cursor="fuse: false" position="0 0 -1" geometry="primitive: ring; radiusInner: 0.02; radiusOuter: 0.03" material="color: white; shader: flat"></a-entity>
        </a-camera>
        <a-entity id="giant-hand" sphere-collider="objects: .target" static-body="shape: sphere; sphereRadius: 2" oculus-touch-controls="hand: left" laser-controls="hand: left"></a-entity>
        <a-entity id="giant-hand-right" sphere-collider="objects: .target" static-body="shape: sphere; sphereRadius: 2" oculus-touch-controls="hand: right" laser-controls="hand: right"></a-entity>
      </a-entity>

    </a-scene>
  </body>
</html>
